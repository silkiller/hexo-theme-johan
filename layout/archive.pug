extends _includes/layout.pug

block content
  div.archive
    if !is_year()
      if theme.atom
        p The feed is available via&nbsp;
          a(href=theme.atom) atom
          span .
        br

      //- Timeline-style archive layout
      - var years = {}
      - var posts = site.posts.toArray()
      
      //- Group posts by year and month
      if posts && posts.length
        each post in posts
          if post && post.date
            - var year = post.date.year()
            - var month = post.date.month() + 1
            - var monthName = post.date.format('MMMM')
            
            - if (!years[year]) years[year] = {}
            - if (!years[year][month]) years[year][month] = { name: monthName, posts: [] }
            - years[year][month].posts.push(post)

      //- Sort years in descending order (newest first)
      - var sortedYears = Object.keys(years).sort((a, b) => b - a)
      
      //- Display years and months in two-column layout
      each year in sortedYears
        - var yearData = years[year]
        - var yearPostCount = 0
        each monthData, month in yearData
          - yearPostCount += monthData.posts.length
        
        //- Year header
        h1 #{year}
        .year-info #{yearPostCount}
        
        //- Sort months in descending order (newest first)
        - var sortedMonths = Object.keys(yearData).sort((a, b) => b - a)
        
        each month in sortedMonths
          - var monthData = yearData[month]
          
          //- Two-column layout: Month on left, posts on right
          .month-section
            .month-header
              .month-name #{monthData.name}
              .month-count #{monthData.posts.length}
            
            .posts-column
              //- Sort posts within month by date descending (newest first)
              - var sortedPosts = monthData.posts.sort((a, b) => b.date - a.date)
              
              each post in sortedPosts
                .archive-post
                  a(href=url_for(post.path))= post.title

    else
      //- Year-specific view
      h1= page.year

      //- Sort posts in descending order (newest first)
      - var sortedArticles = page.posts.toArray().sort((a, b) => b.date - a.date)
      
      //- Group by month for year view
      - var months = {}
      each article in sortedArticles
        if article && article.date
          - var month = article.date.month() + 1
          - var monthName = article.date.format('MMMM')
          - if (!months[month]) months[month] = { name: monthName, posts: [] }
          - months[month].posts.push(article)
      
      //- Sort months in descending order
      - var sortedMonths = Object.keys(months).sort((a, b) => b - a)
      
      each month in sortedMonths
        - var monthData = months[month]
        
        .month-section
          .month-header
            .month-name #{monthData.name}
            .month-count #{monthData.posts.length}
          
          .posts-column
            each article in monthData.posts
              .archive-post
                a(href=url_for(article.path))= article.title

      #paginator!= paginator()
